version: "3.9"

services:
  quenary-install:
    build: php
    working_dir: /app
    command: composer install
    volumes:
      - ./src:/app
    profiles:
      - donotstart
    env_file:
      .env

  quenary-build:
    build: php
    working_dir: /app
    command: sh /app/build.sh
    volumes:
      - ./src:/app
    profiles:
      - donotstart
    env_file:
      .env

  quenary-run:
    build: php
    working_dir: /app
    command: php /app/run.php
    volumes:
      - ./src:/app
    profiles:
      - donotstart
    env_file:
      .env

  quenary-tests:
    build:
      context: .
      dockerfile: php/Dockerfile.tests
    working_dir: /app
    command: sh -c "composer install && composer test"
    volumes:
      - ./src:/app
    profiles:
      - donotstart
    env_file:
      .env